
<!DOCTYPE html>
<html>
  <head>
    <title>Soundtrack Creator | Account</title>
    <link rel="stylesheet" type="text/css" href="/stylesheet.css" />
    <script src="https://www.gstatic.com/firebasejs/5.4.2/firebase.js"></script>
    <script>
      // Initialize Firebase
      var config = {
        apiKey: "AIzaSyCpiKXWlL6a0agcfKAtP5owLxX5Zt0TgJI",
        authDomain: "neutrino-labs.firebaseapp.com",
        databaseURL: "https://neutrino-labs.firebaseio.com",
        projectId: "neutrino-labs",
        storageBucket: "neutrino-labs.appspot.com",
        messagingSenderId: "796838808473"
      };
      firebase.initializeApp(config);
    </script>
    <script type="text/javascript" src="/auth.js"></script>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>

  <body>
    <header><a class="undecor" href="https://neutrino-labs.firebaseapp.com">neutrinolabs</a></header>
    <div class="container">
      <nav id="anon" class="navbar"><a class="navbutton" href="/index.html">Home</a><a class="navbutton" href="/creator.html">Creator</a><a class="navbutton" href="/about.html">About</a><a class="navbutton" href="/login.html">Sign In</a><a class="navbutton" href="/signup.html">Sign Up</a></nav>
      <nav id="user" class="navbar" hidden><a class="navbutton" href="/index.html">Home</a><a class="navbutton" href="/creator.html">Creator</a><a class="navbutton" href="/about.html">About</a><a class="navcurr" href="/account.html">Account</a></nav>
      <h1 class="header caps">
        Soundtrack Creator <span class="secondary">Account</span>
      </h1>
      <div id="content" hidden>
        <h2 id="welcome" class="header"></h2>
        <div class="monospace">
          <button id="name_cancel" onclick="cancel_name_change()" hidden>
            Cancel
          </button>
          <input id="username" type="text" placeholder="Username" onkeypress="process_in_name_field(event)" hidden />
          <button onclick="prompt_name_change()">
            Change Username
          </button>
        </div>
      </div>
    </div>
  </body>
  
  <script type="text/javascript">
    firebase.auth().onAuthStateChanged(function(user) {
      if (user) {
        document.getElementById("content").hidden = false;
        if (window.location.hash) {
          user.updateProfile({
            displayName: window.location.hash.slice(1)
          }).then(function() {
            document.getElementById("welcome").innerHTML = "Welcome, " + user.displayName + "!";
          });
        } else {
          document.getElementById("welcome").innerHTML = "Welcome, " + user.displayName + "!";
        }
      } else {
        window.open("/login.html", "_self");
      }
    });
    
    var changing_name = false;
    
    function process_in_name_field(event) {
      if (event.keyCode == 13) {
        prompt_name_change();
      }
    }
    
    function prompt_name_change() {
      if (changing_name) {
        firebase.auth().currentUser.updateProfile({
          displayName: document.getElementById("username").value
        }).then(function() {
          document.getElementById("welcome").innerHTML = "Welcome, " + firebase.auth().currentUser.displayName + "!";
          document.getElementById("username").value = "";
          document.getElementById("username").hidden = true;
          document.getElementById("name_cancel").hidden = true;
          changing_name = false;
        }, function(error) {
          alert(error.message);
        });
      } else {
        document.getElementById("username").hidden = false;
        document.getElementById("name_cancel").hidden = false;
        changing_name = true;
      }
    }
    
    function cancel_name_change() {
      document.getElementById("username").value = "";
      document.getElementById("username").hidden = true;
      document.getElementById("name_cancel").hidden = true;
      changing_name = false;
    }
  </script>
</html>